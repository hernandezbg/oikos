{% extends 'base.html' %}
{% load static %}

{% block title %}Contadora de Billetes - {{ APP_NAME }}{% endblock %}
{% block page_title %}Contadora de Billetes{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-calculator"></i> Contadora de Billetes
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    <i class="bi bi-info-circle"></i>
                    Ingresa la cantidad de billetes de cada denominación para calcular el total.
                </p>

                <form id="formContadora">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 40%;">Denominación</th>
                                    <th style="width: 30%;">Cantidad</th>
                                    <th style="width: 30%;" class="text-end">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- $20000 -->
                                <tr>
                                    <td>
                                        <span class="badge bg-info fs-6">$20.000</span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control billete-input"
                                               id="billete_20000" data-valor="20000"
                                               min="0" value="0" placeholder="0">
                                    </td>
                                    <td class="text-end fw-bold subtotal" id="subtotal_20000">$0,00</td>
                                </tr>

                                <!-- $10000 -->
                                <tr>
                                    <td>
                                        <span class="badge bg-success fs-6">$10.000</span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control billete-input"
                                               id="billete_10000" data-valor="10000"
                                               min="0" value="0" placeholder="0">
                                    </td>
                                    <td class="text-end fw-bold subtotal" id="subtotal_10000">$0,00</td>
                                </tr>

                                <!-- $2000 -->
                                <tr>
                                    <td>
                                        <span class="badge bg-primary fs-6">$2.000</span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control billete-input"
                                               id="billete_2000" data-valor="2000"
                                               min="0" value="0" placeholder="0">
                                    </td>
                                    <td class="text-end fw-bold subtotal" id="subtotal_2000">$0,00</td>
                                </tr>

                                <!-- $1000 -->
                                <tr>
                                    <td>
                                        <span class="badge bg-warning text-dark fs-6">$1.000</span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control billete-input"
                                               id="billete_1000" data-valor="1000"
                                               min="0" value="0" placeholder="0">
                                    </td>
                                    <td class="text-end fw-bold subtotal" id="subtotal_1000">$0,00</td>
                                </tr>

                                <!-- $500 -->
                                <tr>
                                    <td>
                                        <span class="badge bg-secondary fs-6">$500</span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control billete-input"
                                               id="billete_500" data-valor="500"
                                               min="0" value="0" placeholder="0">
                                    </td>
                                    <td class="text-end fw-bold subtotal" id="subtotal_500">$0,00</td>
                                </tr>

                                <!-- $200 -->
                                <tr>
                                    <td>
                                        <span class="badge bg-danger fs-6">$200</span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control billete-input"
                                               id="billete_200" data-valor="200"
                                               min="0" value="0" placeholder="0">
                                    </td>
                                    <td class="text-end fw-bold subtotal" id="subtotal_200">$0,00</td>
                                </tr>

                                <!-- $100 -->
                                <tr>
                                    <td>
                                        <span class="badge bg-dark fs-6">$100</span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control billete-input"
                                               id="billete_100" data-valor="100"
                                               min="0" value="0" placeholder="0">
                                    </td>
                                    <td class="text-end fw-bold subtotal" id="subtotal_100">$0,00</td>
                                </tr>

                                <!-- $50 -->
                                <tr>
                                    <td>
                                        <span class="badge bg-info fs-6">$50</span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control billete-input"
                                               id="billete_50" data-valor="50"
                                               min="0" value="0" placeholder="0">
                                    </td>
                                    <td class="text-end fw-bold subtotal" id="subtotal_50">$0,00</td>
                                </tr>
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <td colspan="2" class="text-end fw-bold fs-5">TOTAL:</td>
                                    <td class="text-end fw-bold fs-4 text-success" id="total">$0,00</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <div class="d-flex gap-2 mt-3">
                        <button type="button" class="btn btn-warning" id="btnLimpiar">
                            <i class="bi bi-eraser"></i> Limpiar
                        </button>
                        <button type="button" class="btn btn-secondary" id="btnCopiar">
                            <i class="bi bi-clipboard"></i> Copiar Total
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Información adicional -->
        <div class="card shadow-sm mt-3">
            <div class="card-body">
                <h6 class="card-title"><i class="bi bi-lightbulb"></i> Tip</h6>
                <p class="card-text text-muted mb-0" style="font-size: 0.75rem;">
                    Esta herramienta te ayuda a contar dinero en efectivo de forma rápida y precisa.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('.billete-input');
    const totalElement = document.getElementById('total');
    const btnLimpiar = document.getElementById('btnLimpiar');
    const btnCopiar = document.getElementById('btnCopiar');

    // Función para formatear pesos
    function formatoPesos(monto) {
        const partes = monto.toFixed(2).split('.');
        const parteEntera = partes[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        const parteDecimal = partes[1];
        return `$${parteEntera},${parteDecimal}`;
    }

    // Función para calcular subtotales y total
    function calcular() {
        let total = 0;

        inputs.forEach(input => {
            const cantidad = parseInt(input.value) || 0;
            const valor = parseInt(input.dataset.valor);
            const subtotal = cantidad * valor;

            // Actualizar subtotal en la tabla
            const denominacion = valor;
            const subtotalElement = document.getElementById(`subtotal_${denominacion}`);
            subtotalElement.textContent = formatoPesos(subtotal);

            // Acumular total
            total += subtotal;
        });

        // Actualizar total
        totalElement.textContent = formatoPesos(total);
    }

    // Escuchar cambios en los inputs
    inputs.forEach(input => {
        input.addEventListener('input', calcular);
    });

    // Botón limpiar
    btnLimpiar.addEventListener('click', function() {
        inputs.forEach(input => {
            input.value = 0;
        });
        calcular();
    });

    // Botón copiar
    btnCopiar.addEventListener('click', function() {
        const totalText = totalElement.textContent;

        // Copiar al portapapeles
        navigator.clipboard.writeText(totalText).then(function() {
            // Cambiar texto del botón temporalmente
            const iconOriginal = btnCopiar.innerHTML;
            btnCopiar.innerHTML = '<i class="bi bi-check-circle"></i> Copiado';
            btnCopiar.classList.remove('btn-secondary');
            btnCopiar.classList.add('btn-success');

            setTimeout(function() {
                btnCopiar.innerHTML = iconOriginal;
                btnCopiar.classList.remove('btn-success');
                btnCopiar.classList.add('btn-secondary');
            }, 2000);
        }).catch(function(err) {
            alert('Error al copiar: ' + err);
        });
    });

    // Calcular al cargar la página
    calcular();
});
</script>
{% endblock %}
